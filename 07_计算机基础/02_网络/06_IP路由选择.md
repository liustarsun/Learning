# 1. 静态路由选择
1. 如果主机没有被配置成路由功能，那么收到的数据报中，如果目的地地址不是本机就要被丢弃
2. 静态路由选择：
- a. 对直接连接的接口，以默认的方式生成路由表
- b. 通过route命令增加路由表项
- c. 通过ICMP重定向生成表项

## 1.1 选路的原理
1. 路由表中包含的信息决定了IP层所做的所有决策，IP搜索路由表的步骤如下：
- a. 搜索匹配的主机地址      
- b. 搜索匹配的网络地址
- c. 搜索默认表项

2. 选路机制==>IP
搜索路由表并决定向哪个网络接口发送分组==>是一组把哪些路由放入路由表的规则      

3. 选路策略==>路由守护进程

## 1.2 简单路由表
```
// 查看路由表
$ netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         135.252.5.1     0.0.0.0         UG        0 0          0 eth0
135.252.5.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U         0 0          0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U         0 0          0 docker0
```
1. 如果目的地是0.0.0.0(目的地)，那么网关(路由器)将把分组转发给135.252.5.1，这正是我们期望的
2. 对于给定的一个路由器，可以打印出五种不同的标志(flag)
- a. U该路由可以使用
- b. G该路由是个网关(路由器)，如果没有这个标志，**说明目的地是直连的**==>**区分了直接路由和间接路由**
- c. H该路由是到一个主机，即目的地址是一个完整的主机地址，如果没有设置该标志，说明该路由是到一个网络，目的地址是一个网络地址：一个网络号，或者是网络号+子网号的组合
- d. D该路由是重定向报文创建的
- e. M该路由已被重定向报文修改

3. 直接路由和间接路由区别：**发往直接路由的分组中不但具有指明目的地的IP地址，还要有链路层地址**；**发往间接路由的分组中，IP地址指明的是最终目的地的地址，但是链路层给的是网关(下一站路由器地址)**

## 1.3 ICMP主机与网络不可达差错
1. 当路由器收到一份IP数据报，但是又不能转发时，就会发送一份ICMP主机不可达

## 1.4 ICMP重定向差错
1. 当IP数据报应该被发送到另一个路由器，收到数据报的路由器就要发送**ICMP重定向差错报文给IP数据报的发送端**==>只有当主机**选择路由器发送分组的情况下，才会有ICMP重定向报文**
2. 假定R1是主机的默认路由，主机发送一份IP数据报给R1==>R1收到数据报并检查它的路由表，发现R2是发送数据报的下一站，当它把数据报发送给R2时，R1检测到它正在发送的接口与到达数据报的接口是相同的(即主机和两个路由器所在的LAN)==>给原始发送端提供了线索
3. R1发送一个ICMP重定向报文给主机，告诉它以后把数据报发送给R2而不是R1
4. **ICMP重定向一般用来让具有很少选路信息的主机逐渐建立更完整的路由表**

------
# 2. 动态路由选择
1. 动态路由协议，用于路由器间的通信，而相邻路由器通信时，需要告知对方每个路由器当前所连接的网络
2. 路由器需要通过选路协议进行通信，路由器上有一个**路由守护进程，它运行选路协议，并且和它相邻的一些路由器进行通信**
3. 动态选路也是经过选主机，网络，默认路由三种方式，只是放在路由表中的信息改变了==>当路由随着时间变化时，路由由路由守护进程动态增加或删除

## 2.1 IGP
### 2.1.1 RIP
最常用的内部路由协议是RIP，其常用的UDP端口号是520，它要求相邻路由发送自己全部/部分路由信息给它，用来更新路由表，根据跳数来定      

### 2.1.2 OSPF
链路状态协议，路由器不和相邻的路由器交换信息，它把自己的信息发到邻站，而让邻站传播      

## 2.2 EGP