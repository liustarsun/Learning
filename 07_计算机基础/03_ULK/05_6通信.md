# 进程通信（IPC, Inter-Process Communication）
------
## 进程通信是进程进行通信和同步的机制
IPC提供2个基本操作
1. 发送操作：send(message)
2. 接收操作：receive(message)

进程通信流程
1. 在通信进程间建立通信链路
2. 通过 send/receive交换消息

进程链路特征
1. 物理(如，共享内存，硬件总线）
2. 逻辑(如，逻辑属性）

通信方式
**间接通信**
通过操作系统维护的消息队列实现进程间的消息接收和发送
1. 每个消息队列都有一个唯一的标识
2. 只有共享了相同消息队列的进程，才能够通信

通信链路的属性
只有共享了相同消息队列的进程，才建立连接
连接可以是单向或双向
消息队列可以与多个进程相关联
每对进程可以共享多个消息队列

1. 创建一个消息队列
2. 通过消息队列发送和接收消息
3. 销毁消息队列

**直接通信**
通过共享信道
进程必须正确的命名对方
send (P, message) – 发送信息到进程P
receive(Q, message) – 从进程 Q接受消息

通信链路属性
自动建立链路；一条链路恰好对应一对通信进程；每对进程之间只有一个链接存在；链接可以是单向的，但通常为双向的


------
## 阻塞和非阻塞通信
进程通信可划分为阻塞（同步）或非阻塞（异步）
阻塞通信：
阻塞发送：发送者在发送消息后进入等待，直到接收者成功收到
阻塞接收：接收者在请求接收消息后进入等待，直到成功收到一个消息

非阻塞通信；
非阻塞发送：发送者在消息发送后，可立即进行其他操作
非阻塞接收：没有消息发送时，接收者在请求接收消息后，接收不到任何消息

## 通信链路缓冲
进程发送的消息在链路上可能有3种缓冲方式
0 容量：发送方必须等待接收方
有限容量：通信链路缓冲队列满时，发送方必须等待
无限容量：发送方不需要等待



------
## 信号
进程间的软件中断通知和处理机制：如：SIGKILL, SIGSTOP, SIGCONT等

信号的接收处理：
1. 捕获(catch)：执行进程指定的信号处理函数被调用
2. 忽略(Ignore)：执行操作系统指定的缺省处理，进程中止，进程挂起等
3. 屏蔽（Mask）：禁止进程接收和处理信号，可能是暂时的(当处理同样类型的信号)

不足：传送的信息量小，只有一个信号类型

------
## 管道
进程间基于内存文件的通信机制
子进程从父进程继承文件描述符
缺省文件描述符：0 stdin, 1 stdout, 2 stderr
进程不知道（或不关心！）的另一端
可能从键盘、文件、程序读取
可能写入到终端、文件、程序

###  相关系统调用
读管道：read(fd, buffer, nbytes) scanf()是基于它实现的
写管道： write(fd, buffer, nbytes) printf()是基于它实现的
创建管道：pipe(rgfd)
rgfd是2个文件描述符组成的数组
rgfd[0]是读文件描述符
rgfd[1]是写文件描述符


-----
## pipe


------
## 共享内存
共享内存是把同一个物理内存区域同时映射到多个进程的内存地址空间的通信机制
每个进程都有私有内存地址空间
每个进程的内存地址空间需明确设置共享内存段


同一进程中的线程总是共享相同的内存地址空间

优点：快速、方便地共享数据
不足：必须用额外的同步机制来协调数据访问

### 系统调用
shmget( key, size, flags）
创建共享段


shmat( shmid, *shmaddr, flags）
把共享段映射到进程地址空间

shmdt( *shmaddr）
取消共享段到进程地址空间的映射

shmctl( …）
共享段控制


需要信号量等机制协调共享内存的访问冲突

------
## 消息队列
消息队列是由操作系统维护的以字节序列为基本单位的间接通信机制
每个消息(Message)是一个字节序列
相同标识的消息组成按先进先出顺序组成一个消息队列（Message Queues）

### 系统调用
msgget ( key, flags）
获取消息队列标识

msgsnd ( QID, buf, size, flags ）
发送消息


msgrcv ( QID, buf, size, type, flags ）
接收消息


msgctl( … ）
消息队列控制
