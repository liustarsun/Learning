## **Ubuntu系统安装minikube**
> 前提是要有hypervisor，如virtualbox; 要有kubectl; 来自官网链接[点我](https://kubernetes.io/docs/tasks/tools/install-minikube/)

#### **第一步：安装virtualbox**
```
asb@HP8300:~$ proxychains4 apt-get install virtualbox
```
#### **第二步：安装kubectl**
```
// 不要使用root权限
xingyanl@xy:~$ proxychains4 curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.9.0/bin/linux/amd64/kubectl
xingyanl@xy:~$ chmod +x ./kubectl
xingyanl@xy:~$ sudo mv ./kubectl /usr/local/bin/kubectl
```

#### **第三步：安装minikube**
```
// 下载linux版本minikube
xingyanl@xy:~$ proxychains4 curl -Lo minikube curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.24.1/minikube-linux-amd64
// 下载aliyun上面的版本的
xingyanl@xy:~$ proxychains4 curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.23.0/minikube-linux-amd64

xingyanl@xy:~$ chmod +x minikube
xingyanl@xy:~$ sudo mv minikube /usr/local/bin/

asb@HP8300:~$ cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 135.252.5.1
asb@HP8300:~$

minikube start --vm-driver=virtualbox --docker-env HTTP_PROXY=http://135.245.48.34:8000/  --docker-env HTTPS_PROXY=http://135.245.48.34:8000/

// 单独下载localkube-v1.8.0
asb@HP8300:~$ proxychains4 wget https://storage.googleapis.com/minikube/k8sReleases/v1.8.0/localkube-linux-amd64
asb@HP8300:~$ mv localkube-linux-amd64 localkube-v1.8.0
asb@HP8300:~$ mv localkube-v1.8.0 .minikube/cache/localkube/

// 单独下载minikube-v0.23.6.iso
asb@HP8300:~/.minikube/cache/iso$ proxychains4 wget https://storage.googleapis.com/minikube/iso/minikube-v0.23.6.iso
asb@HP8300:~$ mv minikube-v0.23.6.iso .minikube/cache/iso/

// 启动
asb@HP8300:~$ minikube start
Starting local Kubernetes v1.8.0 cluster...
Starting VM...
Getting VM IP address...
Moving files into cluster...
Setting up certs...
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
asb@HP8300:~$ 

// 测试
asb@HP8300:~$ minikube version
minikube version: v0.23.0
asb@HP8300:~$ kubectl version
Client Version: version.Info{Major:"1", Minor:"9", GitVersion:"v1.9.0", GitCommit:"925c127ec6b946659ad0fd596fa959be43f0cc05", GitTreeState:"clean", BuildDate:"2017-12-15T21:07:38Z", GoVersion:"go1.9.2", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"8", GitVersion:"v1.8.0", GitCommit:"0b9efaeb34a2fc51ff8e4d34ad9bc6375459c4a4", GitTreeState:"clean", BuildDate:"2017-11-29T22:43:34Z", GoVersion:"go1.9.1", Compiler:"gc", Platform:"linux/amd64"}
asb@HP8300:~$ 




// 成功的下载一次
asb@HP8300:~$ minikube start --vm-driver=virtualbox --docker-env HTTP_PROXY=http://135.245.48.34:8000/  --docker-env HTTPS_PROXY=http://135.245.48.34:8000/========================================
kubectl could not be found on your path. kubectl is a requirement for using minikube
To install kubectl, please run the following:

curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

To disable this message, run the following:

minikube config set WantKubectlDownloadMsg false
========================================
Starting local Kubernetes v1.8.0 cluster...
Starting VM...
Downloading Minikube ISO
 0 B / 140.01 MB [-----------------------------------------------------]   0.00%^C
asb@HP8300:~$ proxychains4 minikube start --vm-driver=virtualbox --docker-env HTTP_PROXY=http://135.245.48.34:8000/  --docker-env HTTPS_PROXY=http://135.245.48.34:8000/
[proxychains] config file found: /etc/proxychains.conf
[proxychains] preloading /usr/local/lib/libproxychains4.so
========================================
kubectl could not be found on your path. kubectl is a requirement for using minikube
To install kubectl, please run the following:

curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

To disable this message, run the following:

minikube config set WantKubectlDownloadMsg false
========================================
Starting local Kubernetes v1.8.0 cluster...
Starting VM...
Downloading Minikube ISO
 140.01 MB / 140.01 MB [============================================] 100.00% 0s
Getting VM IP address...
Moving files into cluster...
Downloading localkube binary
 148.25 MB / 148.25 MB [============================================] 100.00% 0s 
 0 B / 65 B [----------------------------------------------------------]   0.00%
 65 B / 65 B [======================================================] 100.00% 0sSetting up certs...
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
Loading cached images from config file.
asb@HP8300:~$  


asb@HP8300:~$ minikube stop
========================================
kubectl could not be found on your path. kubectl is a requirement for using minikube
To install kubectl, please run the following:

curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

To disable this message, run the following:

minikube config set WantKubectlDownloadMsg false
========================================
Stopping local Kubernetes cluster...
Machine stopped.
asb@HP8300:~$ proxychains4 minikube start --vm-driver=virtualbox --docker-env HTTP_PROXY=http://135.245.48.34:8000/  --docker-env HTTPS_PROXY=http://135.245.48.34:8000/
[proxychains] config file found: /etc/proxychains.conf
[proxychains] preloading /usr/local/lib/libproxychains4.so
========================================
kubectl could not be found on your path. kubectl is a requirement for using minikube
To install kubectl, please run the following:

curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/

To disable this message, run the following:

minikube config set WantKubectlDownloadMsg false
========================================
Starting local Kubernetes v1.8.0 cluster...
Starting VM...
^C
asb@HP8300:~$ ^C
asb@HP8300:~$ ^C
asb@HP8300:~$ curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 49.8M  100 49.8M    0     0   655k      0  0:01:17  0:01:17 --:--:--  314k
asb@HP8300:~$ proxychains4 minikube start --vm-driver=virtualbox --docker-env HTTP_PROXY=http://135.245.48.34:8000/  --docker-env HTTPS_PROXY=http://135.245.48.34:8000/      
[proxychains] config file found: /etc/proxychains.conf
[proxychains] preloading /usr/local/lib/libproxychains4.so
Starting local Kubernetes v1.8.0 cluster...
Starting VM...
Getting VM IP address...
Moving files into cluster...
Setting up certs...
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
Loading cached images from config file.
asb@HP8300:~$ 

asb@HP8300:~$ kubectl version
Client Version: version.Info{Major:"1", Minor:"8", GitVersion:"v1.8.0", GitCommit:"6e937839ac04a38cac63e6a7a306c5d035fe7b0a", GitTreeState:"clean", BuildDate:"2017-09-28T22:57:57Z", GoVersion:"go1.8.3", Compiler:"gc", Platform:"linux/amd64"}
Unable to connect to the server: Tunnel Connection Failed
asb@HP8300:~$ kubectl run --image=nginx nginx-app --port=80
error: failed to discover supported resources: Get https://192.168.99.101:8443/api: Tunnel Connection Failed
asb@HP8300:~$ kubectl run --image=nginx nginx-app --port=80
error: failed to discover supported resources: Get https://192.168.99.101:8443/api: Tunnel Connection Failed
```

#### **遇到的问题**
```
// 问题1：
Error starting host: Error attempting to cache minikube ISO from URL: Error downloading Minikube ISO: failed to download: failed to download to temp file: download failed: 5 error(s) occurred:

// 解决方案：
单独下载每个需要的镜像，如上面所示

// docker无法下载，修改代理配置
asb@HP8300:~$ cat /etc/default/docker

asb@HP8300:~$ cat /etc/default/docker      
# Docker Upstart and SysVinit configuration file

#
# THIS FILE DOES NOT APPLY TO SYSTEMD
#
#   Please see the documentation for "systemd drop-ins":
#   https://docs.docker.com/engine/admin/systemd/
#

# Customize location of Docker binary (especially for development testing).
#DOCKERD="/usr/local/bin/dockerd"

# Use DOCKER_OPTS to modify the daemon startup options.
DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"

# If you need Docker to use an HTTP proxy, it can also be specified here.
export http_proxy="socks5://135.251.123.122:9900"
export https_proxy="socks5://135.251.123.122:9900"

# This is also a handy place to tweak where Docker's temporary files go.
#export DOCKER_TMPDIR="/mnt/bigdrive/docker-tmp"
asb@HP8300:~$
```


============

