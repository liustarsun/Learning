# I2C：Inter-IC Bus 
> Inter-Integrated Circuit，是一种双向2线制的同步串行通讯接口

------
## 1. 基本特征
1. 串行的，时钟都是一个clock，一个clock的跳变
2. 它是同步的，从主机到一个或者多个从设备，它有一个时钟线是大家共享的，大家都在一个时钟节拍下看这些数据
3. 信号是单端
4. 双向的，但是非双工
5. 主从
6. 总线
7. 不需要片选，对主设备的选择和数据方向的选择都是在**通讯协议中定义的**，因此引入了完善的数据帧，或者**数据协议的概念**

------
## 2. 电气特性
- 主机和从设备所使用的**两根信号线**和一个**地线**
> 1. SDA 串行数据线
> 2. SCL 串行时钟线

- 两根信号引脚都不是普通的IO, 是特殊的引脚，可**线与**
> 1. 漏极开路
> 2. 集电级开路

- 无论主机还是从设备都伸出了两个引脚，分别都挂载了SDA和SCL这样的一根通讯线上，这两个线通过上拉电阻进行上拉，如果想输出逻辑1，上拉电阻处在了高电阻
- 总线空闲时，默认状态是逻辑1的
- 大家都是1才是1，只要有一个是0，就是逻辑0，也即是线与，逻辑与的结果
- 兼容性好

------
## 3. 电平逻辑
- I2C的时钟永远是电平有效的，总是在高电平或者低电平这个时间段里面发生变化
- 数据线SDA的电平，在时钟线SCL为**低电平的时候**，发生变化，也就是bit从1到0，从0到1的时候
- 数据线SDA的电平，在时钟线SCL为**高电平的时候**，保存稳定不变，便于主机或者从机确定数据的值
- SDA仅仅在特殊情况下(I2C总线开始或者结束时)，在SCL位高时变化

### 3.1 起始和停止
- 起始位：
> 当SCL处于高电平时，SDA从默认的高电平向低电平跳变，产生**起始位**，总线在起始条件产生后便处于忙(Busy)的状态，可以将起始位简记为S

- 停止位:
> 当SCL处于高电平时，SDA从默认的低电平向高电平跳变，产生**停止位**，总线在停止条件产生后便处于空闲的(idle)的状态，可以简记为P

### 3.2 优点 
- 只需要2根信号线
- 协议简单
- 协议容易实现
- 支持器件多
- 总线可挂多个器件
- 速率高
- 距离较远

------
## 4. 通讯协议

### 4.1 地址概念
- I2C总线里面，主机的地址无所谓，从机**用7bit表示地址**，因此连接在总线上的从设备都一个一个7bit的地址，并且不能重复
> 1. I2C总线可以连接多个从机设备，不需要额外的片选信号引脚
> 2. 多个从机设备，使用地址进行区分
> 3. 主机不需要地址，从机必须有地址
> 4. 从机地址不能重复，地址位7bit

### 4.2 协议帧的格式：
- S--->SA--->W/R---->A/~A---->D---->P
> 主机不会放弃时钟线的控制，但是会放弃数据线的控制
- 传送的时候MSB在前，LSB在后，也就是**高位先发送**，**低位后发送**
- 单次主机发起的通讯中，只能有一个方向
- 片内晶振产生的默认的时钟

### 4.3 I2C控制器
- 把发送的数据丢给**I2C控制器的寄存器**，I2C控制器寄存器会设置约定，从而不需要直接操作引脚
> 从机地址7位，可以接128个设备；

- 访问设备：起始信号中**前7位代表从设备的地址**，从设备的可以从I2C设备的数据手册中得到，**第8位一位代表写/读**；如果设备存在，则**回ACK**
> 发送数据的含义，则根据接的具体的I2C芯片手册来决定
